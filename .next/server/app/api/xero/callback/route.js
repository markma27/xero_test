"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/xero/callback/route";
exports.ids = ["app/api/xero/callback/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/next@14.0.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fxero%2Fcallback%2Froute&page=%2Fapi%2Fxero%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fxero%2Fcallback%2Froute.ts&appDir=C%3A%5CUsers%5Cmayin%5CDesktop%5Cxero_test%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cmayin%5CDesktop%5Cxero_test&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@14.0.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fxero%2Fcallback%2Froute&page=%2Fapi%2Fxero%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fxero%2Fcallback%2Froute.ts&appDir=C%3A%5CUsers%5Cmayin%5CDesktop%5Cxero_test%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cmayin%5CDesktop%5Cxero_test&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/.pnpm/next@14.0.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/.pnpm/next@14.0.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var C_Users_mayin_Desktop_xero_test_src_app_api_xero_callback_route_ts__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./src/app/api/xero/callback/route.ts */ \"(rsc)/./src/app/api/xero/callback/route.ts\");\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/xero/callback/route\",\n        pathname: \"/api/xero/callback\",\n        filename: \"route\",\n        bundlePath: \"app/api/xero/callback/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\mayin\\\\Desktop\\\\xero_test\\\\src\\\\app\\\\api\\\\xero\\\\callback\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_mayin_Desktop_xero_test_src_app_api_xero_callback_route_ts__WEBPACK_IMPORTED_MODULE_2__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/xero/callback/route\";\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbmV4dEAxNC4wLjBfcmVhY3QtZG9tQDE4LjMuMV9yZWFjdEAxOC4zLjFfX3JlYWN0QDE4LjMuMS9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ4ZXJvJTJGY2FsbGJhY2slMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnhlcm8lMkZjYWxsYmFjayUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnhlcm8lMkZjYWxsYmFjayUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNtYXlpbiU1Q0Rlc2t0b3AlNUN4ZXJvX3Rlc3QlNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q21heWluJTVDRGVza3RvcCU1Q3hlcm9fdGVzdCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDMkM7QUFDMUc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDaUo7O0FBRWpKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8veGVyby1vYXV0aC1wcm90b3R5cGUvPzlmMTciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcbWF5aW5cXFxcRGVza3RvcFxcXFx4ZXJvX3Rlc3RcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxceGVyb1xcXFxjYWxsYmFja1xcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkveGVyby9jYWxsYmFjay9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3hlcm8vY2FsbGJhY2tcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3hlcm8vY2FsbGJhY2svcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxtYXlpblxcXFxEZXNrdG9wXFxcXHhlcm9fdGVzdFxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFx4ZXJvXFxcXGNhbGxiYWNrXFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3hlcm8vY2FsbGJhY2svcm91dGVcIjtcbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0LCBvcmlnaW5hbFBhdGhuYW1lLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/next@14.0.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fxero%2Fcallback%2Froute&page=%2Fapi%2Fxero%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fxero%2Fcallback%2Froute.ts&appDir=C%3A%5CUsers%5Cmayin%5CDesktop%5Cxero_test%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cmayin%5CDesktop%5Cxero_test&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/xero/callback/route.ts":
/*!********************************************!*\
  !*** ./src/app/api/xero/callback/route.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/.pnpm/next@14.0.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_xero__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/xero */ \"(rsc)/./src/lib/xero.ts\");\n\n\nasync function GET(req) {\n    try {\n        const xero = (0,_lib_xero__WEBPACK_IMPORTED_MODULE_1__.newXeroClient)();\n        const tokenSet = await xero.apiCallback(req.url);\n        console.log(\"Token set received:\", {\n            access_token: tokenSet.access_token ? \"present\" : \"missing\",\n            refresh_token: tokenSet.refresh_token ? \"present\" : \"missing\",\n            expires_at: tokenSet.expires_at,\n            scopes: tokenSet.scope\n        });\n        // XPM-only: resolve connections via /connections endpoint (no Accounting)\n        const connections = await (0,_lib_xero__WEBPACK_IMPORTED_MODULE_1__.fetchConnections)(tokenSet.access_token);\n        console.log(\"Connections found:\", Array.isArray(connections) ? connections.length : 0);\n        const tenantId = Array.isArray(connections) ? connections[0]?.tenantId : undefined;\n        if (!tenantId) {\n            console.error(\"No tenant found. Available tenants:\", tenants);\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"No tenant connection\",\n                debug: {\n                    tenantsCount: tenants?.length || 0,\n                    tenants: tenants,\n                    tokenScopes: tokenSet.scope\n                }\n            }, {\n                status: 400\n            });\n        }\n        // Persist token for ALL connections\n        for (const c of connections || []){\n            if (c?.tenantId) await (0,_lib_xero__WEBPACK_IMPORTED_MODULE_1__.saveTokenSet)(c.tenantId, tokenSet);\n        }\n        const baseUrl = process.env.NEXTAUTH_URL || \"http://localhost:3000\";\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(`${baseUrl}/xpm/connected?tenantId=${tenantId}`);\n    } catch (error) {\n        console.error(\"OAuth callback error:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"OAuth callback failed\",\n            message: error.message,\n            details: error.toString()\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS94ZXJvL2NhbGxiYWNrL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUF3RDtBQUNtQjtBQUVwRSxlQUFlSSxJQUFJQyxHQUFnQjtJQUN4QyxJQUFJO1FBQ0YsTUFBTUMsT0FBT0wsd0RBQWFBO1FBQzFCLE1BQU1NLFdBQVcsTUFBTUQsS0FBS0UsV0FBVyxDQUFDSCxJQUFJSSxHQUFHO1FBRS9DQyxRQUFRQyxHQUFHLENBQUMsdUJBQXVCO1lBQ2pDQyxjQUFjTCxTQUFTSyxZQUFZLEdBQUcsWUFBWTtZQUNsREMsZUFBZU4sU0FBU00sYUFBYSxHQUFHLFlBQVk7WUFDcERDLFlBQVlQLFNBQVNPLFVBQVU7WUFDL0JDLFFBQVFSLFNBQVNTLEtBQUs7UUFDeEI7UUFFQSwwRUFBMEU7UUFDMUUsTUFBTUMsY0FBYyxNQUFNZCwyREFBZ0JBLENBQUNJLFNBQVNLLFlBQVk7UUFDaEVGLFFBQVFDLEdBQUcsQ0FBQyxzQkFBc0JPLE1BQU1DLE9BQU8sQ0FBQ0YsZUFBZUEsWUFBWUcsTUFBTSxHQUFHO1FBQ3BGLE1BQU1DLFdBQVdILE1BQU1DLE9BQU8sQ0FBQ0YsZUFBZUEsV0FBVyxDQUFDLEVBQUUsRUFBRUksV0FBV0M7UUFFekUsSUFBSSxDQUFDRCxVQUFVO1lBQ2JYLFFBQVFhLEtBQUssQ0FBQyx1Q0FBdUNDO1lBQ3JELE9BQU94QixrRkFBWUEsQ0FBQ3lCLElBQUksQ0FBQztnQkFDdkJGLE9BQU87Z0JBQ1BHLE9BQU87b0JBQ0xDLGNBQWNILFNBQVNKLFVBQVU7b0JBQ2pDSSxTQUFTQTtvQkFDVEksYUFBYXJCLFNBQVNTLEtBQUs7Z0JBQzdCO1lBQ0YsR0FBRztnQkFBRWEsUUFBUTtZQUFJO1FBQ25CO1FBRUEsb0NBQW9DO1FBQ3BDLEtBQUssTUFBTUMsS0FBS2IsZUFBZSxFQUFFLENBQUU7WUFDakMsSUFBSWEsR0FBR1QsVUFBVSxNQUFNbkIsdURBQVlBLENBQUM0QixFQUFFVCxRQUFRLEVBQUVkO1FBQ2xEO1FBQ0EsTUFBTXdCLFVBQVVDLFFBQVFDLEdBQUcsQ0FBQ0MsWUFBWSxJQUFJO1FBQzVDLE9BQU9sQyxrRkFBWUEsQ0FBQ21DLFFBQVEsQ0FBQyxDQUFDLEVBQUVKLFFBQVEsd0JBQXdCLEVBQUVWLFNBQVMsQ0FBQztJQUM5RSxFQUFFLE9BQU9FLE9BQVk7UUFDbkJiLFFBQVFhLEtBQUssQ0FBQyx5QkFBeUJBO1FBQ3ZDLE9BQU92QixrRkFBWUEsQ0FBQ3lCLElBQUksQ0FBQztZQUN2QkYsT0FBTztZQUNQYSxTQUFTYixNQUFNYSxPQUFPO1lBQ3RCQyxTQUFTZCxNQUFNZSxRQUFRO1FBQ3pCLEdBQUc7WUFBRVQsUUFBUTtRQUFJO0lBQ25CO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly94ZXJvLW9hdXRoLXByb3RvdHlwZS8uL3NyYy9hcHAvYXBpL3hlcm8vY2FsbGJhY2svcm91dGUudHM/NzFmNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XHJcbmltcG9ydCB7IG5ld1hlcm9DbGllbnQsIHNhdmVUb2tlblNldCwgZmV0Y2hDb25uZWN0aW9ucyB9IGZyb20gXCJAL2xpYi94ZXJvXCI7XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcTogTmV4dFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeGVybyA9IG5ld1hlcm9DbGllbnQoKTtcclxuICAgIGNvbnN0IHRva2VuU2V0ID0gYXdhaXQgeGVyby5hcGlDYWxsYmFjayhyZXEudXJsKTtcclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coXCJUb2tlbiBzZXQgcmVjZWl2ZWQ6XCIsIHtcclxuICAgICAgYWNjZXNzX3Rva2VuOiB0b2tlblNldC5hY2Nlc3NfdG9rZW4gPyBcInByZXNlbnRcIiA6IFwibWlzc2luZ1wiLFxyXG4gICAgICByZWZyZXNoX3Rva2VuOiB0b2tlblNldC5yZWZyZXNoX3Rva2VuID8gXCJwcmVzZW50XCIgOiBcIm1pc3NpbmdcIixcclxuICAgICAgZXhwaXJlc19hdDogdG9rZW5TZXQuZXhwaXJlc19hdCxcclxuICAgICAgc2NvcGVzOiB0b2tlblNldC5zY29wZVxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIC8vIFhQTS1vbmx5OiByZXNvbHZlIGNvbm5lY3Rpb25zIHZpYSAvY29ubmVjdGlvbnMgZW5kcG9pbnQgKG5vIEFjY291bnRpbmcpXHJcbiAgICBjb25zdCBjb25uZWN0aW9ucyA9IGF3YWl0IGZldGNoQ29ubmVjdGlvbnModG9rZW5TZXQuYWNjZXNzX3Rva2VuISk7XHJcbiAgICBjb25zb2xlLmxvZyhcIkNvbm5lY3Rpb25zIGZvdW5kOlwiLCBBcnJheS5pc0FycmF5KGNvbm5lY3Rpb25zKSA/IGNvbm5lY3Rpb25zLmxlbmd0aCA6IDApO1xyXG4gICAgY29uc3QgdGVuYW50SWQgPSBBcnJheS5pc0FycmF5KGNvbm5lY3Rpb25zKSA/IGNvbm5lY3Rpb25zWzBdPy50ZW5hbnRJZCA6IHVuZGVmaW5lZDtcclxuICAgIFxyXG4gICAgaWYgKCF0ZW5hbnRJZCkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiTm8gdGVuYW50IGZvdW5kLiBBdmFpbGFibGUgdGVuYW50czpcIiwgdGVuYW50cyk7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IFxyXG4gICAgICAgIGVycm9yOiBcIk5vIHRlbmFudCBjb25uZWN0aW9uXCIsIFxyXG4gICAgICAgIGRlYnVnOiB7XHJcbiAgICAgICAgICB0ZW5hbnRzQ291bnQ6IHRlbmFudHM/Lmxlbmd0aCB8fCAwLFxyXG4gICAgICAgICAgdGVuYW50czogdGVuYW50cyxcclxuICAgICAgICAgIHRva2VuU2NvcGVzOiB0b2tlblNldC5zY29wZVxyXG4gICAgICAgIH1cclxuICAgICAgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gUGVyc2lzdCB0b2tlbiBmb3IgQUxMIGNvbm5lY3Rpb25zXHJcbiAgICBmb3IgKGNvbnN0IGMgb2YgY29ubmVjdGlvbnMgfHwgW10pIHtcclxuICAgICAgaWYgKGM/LnRlbmFudElkKSBhd2FpdCBzYXZlVG9rZW5TZXQoYy50ZW5hbnRJZCwgdG9rZW5TZXQpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRBVVRIX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAwJztcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QoYCR7YmFzZVVybH0veHBtL2Nvbm5lY3RlZD90ZW5hbnRJZD0ke3RlbmFudElkfWApO1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJPQXV0aCBjYWxsYmFjayBlcnJvcjpcIiwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXHJcbiAgICAgIGVycm9yOiBcIk9BdXRoIGNhbGxiYWNrIGZhaWxlZFwiLCBcclxuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcclxuICAgICAgZGV0YWlsczogZXJyb3IudG9TdHJpbmcoKVxyXG4gICAgfSwgeyBzdGF0dXM6IDUwMCB9KTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIm5ld1hlcm9DbGllbnQiLCJzYXZlVG9rZW5TZXQiLCJmZXRjaENvbm5lY3Rpb25zIiwiR0VUIiwicmVxIiwieGVybyIsInRva2VuU2V0IiwiYXBpQ2FsbGJhY2siLCJ1cmwiLCJjb25zb2xlIiwibG9nIiwiYWNjZXNzX3Rva2VuIiwicmVmcmVzaF90b2tlbiIsImV4cGlyZXNfYXQiLCJzY29wZXMiLCJzY29wZSIsImNvbm5lY3Rpb25zIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwidGVuYW50SWQiLCJ1bmRlZmluZWQiLCJlcnJvciIsInRlbmFudHMiLCJqc29uIiwiZGVidWciLCJ0ZW5hbnRzQ291bnQiLCJ0b2tlblNjb3BlcyIsInN0YXR1cyIsImMiLCJiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRBVVRIX1VSTCIsInJlZGlyZWN0IiwibWVzc2FnZSIsImRldGFpbHMiLCJ0b1N0cmluZyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/xero/callback/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/crypto.ts":
/*!***************************!*\
  !*** ./src/lib/crypto.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   decrypt: () => (/* binding */ decrypt),\n/* harmony export */   encrypt: () => (/* binding */ encrypt)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n\nconst key = Buffer.from(process.env.XERO_TOKEN_ENC_KEY || \"\", \"base64\");\nif (key.length !== 32) {\n    throw new Error(\"XERO_TOKEN_ENC_KEY must be 32 bytes (base64)\");\n}\nfunction encrypt(plain) {\n    const iv = (0,crypto__WEBPACK_IMPORTED_MODULE_0__.randomBytes)(12);\n    const cipher = (0,crypto__WEBPACK_IMPORTED_MODULE_0__.createCipheriv)(\"aes-256-gcm\", key, iv);\n    const enc = Buffer.concat([\n        cipher.update(plain, \"utf8\"),\n        cipher.final()\n    ]);\n    const tag = cipher.getAuthTag();\n    return Buffer.concat([\n        iv,\n        tag,\n        enc\n    ]).toString(\"base64\");\n}\nfunction decrypt(blob) {\n    const data = Buffer.from(blob, \"base64\");\n    const iv = data.subarray(0, 12);\n    const tag = data.subarray(12, 28);\n    const enc = data.subarray(28);\n    const decipher = (0,crypto__WEBPACK_IMPORTED_MODULE_0__.createDecipheriv)(\"aes-256-gcm\", key, iv);\n    decipher.setAuthTag(tag);\n    const dec = Buffer.concat([\n        decipher.update(enc),\n        decipher.final()\n    ]);\n    return dec.toString(\"utf8\");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2NyeXB0by50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXVFO0FBRXZFLE1BQU1HLE1BQU1DLE9BQU9DLElBQUksQ0FBQ0MsUUFBUUMsR0FBRyxDQUFDQyxrQkFBa0IsSUFBSSxJQUFJO0FBQzlELElBQUlMLElBQUlNLE1BQU0sS0FBSyxJQUFJO0lBQ3JCLE1BQU0sSUFBSUMsTUFBTTtBQUNsQjtBQUVPLFNBQVNDLFFBQVFDLEtBQWE7SUFDbkMsTUFBTUMsS0FBS1gsbURBQVdBLENBQUM7SUFDdkIsTUFBTVksU0FBU2Qsc0RBQWNBLENBQUMsZUFBZUcsS0FBS1U7SUFDbEQsTUFBTUUsTUFBTVgsT0FBT1ksTUFBTSxDQUFDO1FBQUNGLE9BQU9HLE1BQU0sQ0FBQ0wsT0FBTztRQUFTRSxPQUFPSSxLQUFLO0tBQUc7SUFDeEUsTUFBTUMsTUFBTUwsT0FBT00sVUFBVTtJQUM3QixPQUFPaEIsT0FBT1ksTUFBTSxDQUFDO1FBQUNIO1FBQUlNO1FBQUtKO0tBQUksRUFBRU0sUUFBUSxDQUFDO0FBQ2hEO0FBRU8sU0FBU0MsUUFBUUMsSUFBWTtJQUNsQyxNQUFNQyxPQUFPcEIsT0FBT0MsSUFBSSxDQUFDa0IsTUFBTTtJQUMvQixNQUFNVixLQUFLVyxLQUFLQyxRQUFRLENBQUMsR0FBRztJQUM1QixNQUFNTixNQUFNSyxLQUFLQyxRQUFRLENBQUMsSUFBSTtJQUM5QixNQUFNVixNQUFNUyxLQUFLQyxRQUFRLENBQUM7SUFDMUIsTUFBTUMsV0FBV3pCLHdEQUFnQkEsQ0FBQyxlQUFlRSxLQUFLVTtJQUN0RGEsU0FBU0MsVUFBVSxDQUFDUjtJQUNwQixNQUFNUyxNQUFNeEIsT0FBT1ksTUFBTSxDQUFDO1FBQUNVLFNBQVNULE1BQU0sQ0FBQ0Y7UUFBTVcsU0FBU1IsS0FBSztLQUFHO0lBQ2xFLE9BQU9VLElBQUlQLFFBQVEsQ0FBQztBQUN0QiIsInNvdXJjZXMiOlsid2VicGFjazovL3hlcm8tb2F1dGgtcHJvdG90eXBlLy4vc3JjL2xpYi9jcnlwdG8udHM/NTBiZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDaXBoZXJpdiwgY3JlYXRlRGVjaXBoZXJpdiwgcmFuZG9tQnl0ZXMgfSBmcm9tIFwiY3J5cHRvXCI7XHJcblxyXG5jb25zdCBrZXkgPSBCdWZmZXIuZnJvbShwcm9jZXNzLmVudi5YRVJPX1RPS0VOX0VOQ19LRVkgfHwgXCJcIiwgXCJiYXNlNjRcIik7XHJcbmlmIChrZXkubGVuZ3RoICE9PSAzMikge1xyXG4gIHRocm93IG5ldyBFcnJvcihcIlhFUk9fVE9LRU5fRU5DX0tFWSBtdXN0IGJlIDMyIGJ5dGVzIChiYXNlNjQpXCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZW5jcnlwdChwbGFpbjogc3RyaW5nKTogc3RyaW5nIHtcclxuICBjb25zdCBpdiA9IHJhbmRvbUJ5dGVzKDEyKTtcclxuICBjb25zdCBjaXBoZXIgPSBjcmVhdGVDaXBoZXJpdihcImFlcy0yNTYtZ2NtXCIsIGtleSwgaXYpO1xyXG4gIGNvbnN0IGVuYyA9IEJ1ZmZlci5jb25jYXQoW2NpcGhlci51cGRhdGUocGxhaW4sIFwidXRmOFwiKSwgY2lwaGVyLmZpbmFsKCldKTtcclxuICBjb25zdCB0YWcgPSBjaXBoZXIuZ2V0QXV0aFRhZygpO1xyXG4gIHJldHVybiBCdWZmZXIuY29uY2F0KFtpdiwgdGFnLCBlbmNdKS50b1N0cmluZyhcImJhc2U2NFwiKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRlY3J5cHQoYmxvYjogc3RyaW5nKTogc3RyaW5nIHtcclxuICBjb25zdCBkYXRhID0gQnVmZmVyLmZyb20oYmxvYiwgXCJiYXNlNjRcIik7XHJcbiAgY29uc3QgaXYgPSBkYXRhLnN1YmFycmF5KDAsIDEyKTtcclxuICBjb25zdCB0YWcgPSBkYXRhLnN1YmFycmF5KDEyLCAyOCk7XHJcbiAgY29uc3QgZW5jID0gZGF0YS5zdWJhcnJheSgyOCk7XHJcbiAgY29uc3QgZGVjaXBoZXIgPSBjcmVhdGVEZWNpcGhlcml2KFwiYWVzLTI1Ni1nY21cIiwga2V5LCBpdik7XHJcbiAgZGVjaXBoZXIuc2V0QXV0aFRhZyh0YWcpO1xyXG4gIGNvbnN0IGRlYyA9IEJ1ZmZlci5jb25jYXQoW2RlY2lwaGVyLnVwZGF0ZShlbmMpLCBkZWNpcGhlci5maW5hbCgpXSk7XHJcbiAgcmV0dXJuIGRlYy50b1N0cmluZyhcInV0ZjhcIik7XHJcbn1cclxuIl0sIm5hbWVzIjpbImNyZWF0ZUNpcGhlcml2IiwiY3JlYXRlRGVjaXBoZXJpdiIsInJhbmRvbUJ5dGVzIiwia2V5IiwiQnVmZmVyIiwiZnJvbSIsInByb2Nlc3MiLCJlbnYiLCJYRVJPX1RPS0VOX0VOQ19LRVkiLCJsZW5ndGgiLCJFcnJvciIsImVuY3J5cHQiLCJwbGFpbiIsIml2IiwiY2lwaGVyIiwiZW5jIiwiY29uY2F0IiwidXBkYXRlIiwiZmluYWwiLCJ0YWciLCJnZXRBdXRoVGFnIiwidG9TdHJpbmciLCJkZWNyeXB0IiwiYmxvYiIsImRhdGEiLCJzdWJhcnJheSIsImRlY2lwaGVyIiwic2V0QXV0aFRhZyIsImRlYyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/crypto.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabaseAdmin.ts":
/*!**********************************!*\
  !*** ./src/lib/supabaseAdmin.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/.pnpm/@supabase+supabase-js@2.57.4/node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nconst url = process.env.SUPABASE_URL;\nconst key = process.env.SUPABASE_SERVICE_ROLE_KEY;\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, key, {\n    auth: {\n        persistSession: false\n    }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N1cGFiYXNlQWRtaW4udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBcUQ7QUFFckQsTUFBTUMsTUFBTUMsUUFBUUMsR0FBRyxDQUFDQyxZQUFZO0FBQ3BDLE1BQU1DLE1BQU1ILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0FBRTFDLE1BQU1DLGdCQUFnQlAsbUVBQVlBLENBQUNDLEtBQUtJLEtBQUs7SUFDbERHLE1BQU07UUFBRUMsZ0JBQWdCO0lBQU07QUFDaEMsR0FBRyIsInNvdXJjZXMiOlsid2VicGFjazovL3hlcm8tb2F1dGgtcHJvdG90eXBlLy4vc3JjL2xpYi9zdXBhYmFzZUFkbWluLnRzP2ViOGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiO1xyXG5cclxuY29uc3QgdXJsID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfVVJMITtcclxuY29uc3Qga2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSE7XHJcblxyXG5leHBvcnQgY29uc3Qgc3VwYWJhc2VBZG1pbiA9IGNyZWF0ZUNsaWVudCh1cmwsIGtleSwgeyBcclxuICBhdXRoOiB7IHBlcnNpc3RTZXNzaW9uOiBmYWxzZSB9IFxyXG59KTtcclxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInVybCIsInByb2Nlc3MiLCJlbnYiLCJTVVBBQkFTRV9VUkwiLCJrZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwic3VwYWJhc2VBZG1pbiIsImF1dGgiLCJwZXJzaXN0U2Vzc2lvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabaseAdmin.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/xero.ts":
/*!*************************!*\
  !*** ./src/lib/xero.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   fetchConnections: () => (/* binding */ fetchConnections),\n/* harmony export */   getClientWithTokens: () => (/* binding */ getClientWithTokens),\n/* harmony export */   newXeroClient: () => (/* binding */ newXeroClient),\n/* harmony export */   newXpmOnlyClient: () => (/* binding */ newXpmOnlyClient),\n/* harmony export */   saveTokenSet: () => (/* binding */ saveTokenSet)\n/* harmony export */ });\n/* harmony import */ var xero_node__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! xero-node */ \"(rsc)/./node_modules/.pnpm/xero-node@13.0.0/node_modules/xero-node/dist/index.js\");\n/* harmony import */ var xero_node__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(xero_node__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _supabaseAdmin__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./supabaseAdmin */ \"(rsc)/./src/lib/supabaseAdmin.ts\");\n/* harmony import */ var _crypto__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./crypto */ \"(rsc)/./src/lib/crypto.ts\");\n\n\n\nfunction newXeroClient() {\n    return new xero_node__WEBPACK_IMPORTED_MODULE_0__.XeroClient({\n        clientId: process.env.XERO_CLIENT_ID,\n        clientSecret: process.env.XERO_CLIENT_SECRET,\n        redirectUris: [\n            process.env.XERO_REDIRECT_URI\n        ],\n        scopes: [\n            \"openid\",\n            \"profile\",\n            \"email\",\n            \"offline_access\",\n            \"practicemanager\"\n        ]\n    });\n}\n// Some tenants/apps cannot mix Accounting and XPM scopes in a single auth.\n// Provide an XPM-only client to avoid invalid scope combinations.\nfunction newXpmOnlyClient() {\n    return new xero_node__WEBPACK_IMPORTED_MODULE_0__.XeroClient({\n        clientId: process.env.XERO_CLIENT_ID,\n        clientSecret: process.env.XERO_CLIENT_SECRET,\n        redirectUris: [\n            process.env.XERO_REDIRECT_URI\n        ],\n        scopes: [\n            \"openid\",\n            \"profile\",\n            \"email\",\n            \"offline_access\",\n            \"practicemanager\"\n        ]\n    });\n}\nasync function saveTokenSet(tenantId, tokenSet) {\n    const tokenJson = JSON.stringify(tokenSet);\n    const expiresAt = tokenSet.expires_at ? new Date(tokenSet.expires_at * 1000).toISOString() : new Date(Date.now() + 3600000).toISOString();\n    const { error } = await _supabaseAdmin__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"xero_tokens\").upsert({\n        tenant_id: tenantId,\n        token_set_enc: (0,_crypto__WEBPACK_IMPORTED_MODULE_2__.encrypt)(tokenJson),\n        expires_at: expiresAt,\n        updated_at: new Date().toISOString()\n    }, {\n        onConflict: \"tenant_id\"\n    });\n    if (error) throw new Error(error.message);\n}\nasync function loadTokenSet(tenantId) {\n    const { data, error } = await _supabaseAdmin__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"xero_tokens\").select(\"*\").eq(\"tenant_id\", tenantId).single();\n    if (error || !data) throw new Error(\"No token for tenant\");\n    return JSON.parse((0,_crypto__WEBPACK_IMPORTED_MODULE_2__.decrypt)(data.token_set_enc));\n}\nasync function getClientWithTokens(tenantId) {\n    const xero = newXeroClient();\n    const tokenSet = await loadTokenSet(tenantId);\n    xero.setTokenSet(tokenSet);\n    // refresh if needed (without using Accounting APIs)\n    const exp = tokenSet.expires_at ? tokenSet.expires_at * 1000 : 0;\n    if (exp && exp < Date.now() + 60000) {\n        const refreshed = await xero.refreshToken();\n        await saveTokenSet(tenantId, refreshed);\n        return {\n            xero,\n            tenantId,\n            tokenSet: refreshed\n        };\n    }\n    return {\n        xero,\n        tenantId,\n        tokenSet\n    };\n}\n// Fetch connections without touching Accounting endpoints\nasync function fetchConnections(accessToken) {\n    const res = await fetch(\"https://api.xero.com/connections\", {\n        headers: {\n            Authorization: `Bearer ${accessToken}`,\n            Accept: \"application/json\"\n        }\n    });\n    if (!res.ok) throw new Error(`connections failed: HTTP ${res.status}`);\n    return await res.json();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFJTSxNQUFNLENBQUMsQ0FBQztJQUNyRSxPQUFPLE1BQU1OLElBQUlPLElBQUk7QUFDdkIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly94ZXJvLW9hdXRoLXByb3RvdHlwZS8uL3NyYy9saWIveGVyby50cz9kM2JlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFhlcm9DbGllbnQsIFRva2VuU2V0IH0gZnJvbSBcInhlcm8tbm9kZVwiO1xyXG5pbXBvcnQgeyBzdXBhYmFzZUFkbWluIH0gZnJvbSBcIi4vc3VwYWJhc2VBZG1pblwiO1xyXG5pbXBvcnQgeyBlbmNyeXB0LCBkZWNyeXB0IH0gZnJvbSBcIi4vY3J5cHRvXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbmV3WGVyb0NsaWVudCgpIHtcclxuICByZXR1cm4gbmV3IFhlcm9DbGllbnQoe1xyXG4gICAgY2xpZW50SWQ6IHByb2Nlc3MuZW52LlhFUk9fQ0xJRU5UX0lEISxcclxuICAgIGNsaWVudFNlY3JldDogcHJvY2Vzcy5lbnYuWEVST19DTElFTlRfU0VDUkVUISxcclxuICAgIHJlZGlyZWN0VXJpczogW3Byb2Nlc3MuZW52LlhFUk9fUkVESVJFQ1RfVVJJIV0sXHJcbiAgICBzY29wZXM6IFtcclxuICAgICAgXCJvcGVuaWRcIixcclxuICAgICAgXCJwcm9maWxlXCIsXHJcbiAgICAgIFwiZW1haWxcIixcclxuICAgICAgXCJvZmZsaW5lX2FjY2Vzc1wiLFxyXG4gICAgICBcInByYWN0aWNlbWFuYWdlclwiXHJcbiAgICBdLCAvLyBYUE0gb25seVxyXG4gIH0pO1xyXG59XHJcblxyXG4vLyBTb21lIHRlbmFudHMvYXBwcyBjYW5ub3QgbWl4IEFjY291bnRpbmcgYW5kIFhQTSBzY29wZXMgaW4gYSBzaW5nbGUgYXV0aC5cclxuLy8gUHJvdmlkZSBhbiBYUE0tb25seSBjbGllbnQgdG8gYXZvaWQgaW52YWxpZCBzY29wZSBjb21iaW5hdGlvbnMuXHJcbmV4cG9ydCBmdW5jdGlvbiBuZXdYcG1Pbmx5Q2xpZW50KCkge1xyXG4gIHJldHVybiBuZXcgWGVyb0NsaWVudCh7XHJcbiAgICBjbGllbnRJZDogcHJvY2Vzcy5lbnYuWEVST19DTElFTlRfSUQhLFxyXG4gICAgY2xpZW50U2VjcmV0OiBwcm9jZXNzLmVudi5YRVJPX0NMSUVOVF9TRUNSRVQhLFxyXG4gICAgcmVkaXJlY3RVcmlzOiBbcHJvY2Vzcy5lbnYuWEVST19SRURJUkVDVF9VUkkhXSxcclxuICAgIHNjb3BlczogW1xyXG4gICAgICBcIm9wZW5pZFwiLFxyXG4gICAgICBcInByb2ZpbGVcIixcclxuICAgICAgXCJlbWFpbFwiLFxyXG4gICAgICBcIm9mZmxpbmVfYWNjZXNzXCIsXHJcbiAgICAgIFwicHJhY3RpY2VtYW5hZ2VyXCJcclxuICAgIF0sXHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzYXZlVG9rZW5TZXQodGVuYW50SWQ6IHN0cmluZywgdG9rZW5TZXQ6IFRva2VuU2V0KSB7XHJcbiAgY29uc3QgdG9rZW5Kc29uID0gSlNPTi5zdHJpbmdpZnkodG9rZW5TZXQpO1xyXG4gIGNvbnN0IGV4cGlyZXNBdCA9IHRva2VuU2V0LmV4cGlyZXNfYXRcclxuICAgID8gbmV3IERhdGUodG9rZW5TZXQuZXhwaXJlc19hdCAqIDEwMDApLnRvSVNPU3RyaW5nKClcclxuICAgIDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDM2MDBfMDAwKS50b0lTT1N0cmluZygpO1xyXG4gIFxyXG4gIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW4uZnJvbShcInhlcm9fdG9rZW5zXCIpLnVwc2VydCh7XHJcbiAgICB0ZW5hbnRfaWQ6IHRlbmFudElkLFxyXG4gICAgdG9rZW5fc2V0X2VuYzogZW5jcnlwdCh0b2tlbkpzb24pLFxyXG4gICAgZXhwaXJlc19hdDogZXhwaXJlc0F0LFxyXG4gICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gIH0sIHsgb25Db25mbGljdDogXCJ0ZW5hbnRfaWRcIiB9KTtcclxuICBcclxuICBpZiAoZXJyb3IpIHRocm93IG5ldyBFcnJvcihlcnJvci5tZXNzYWdlKTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gbG9hZFRva2VuU2V0KHRlbmFudElkOiBzdHJpbmcpOiBQcm9taXNlPFRva2VuU2V0PiB7XHJcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgLmZyb20oXCJ4ZXJvX3Rva2Vuc1wiKVxyXG4gICAgLnNlbGVjdChcIipcIilcclxuICAgIC5lcShcInRlbmFudF9pZFwiLCB0ZW5hbnRJZClcclxuICAgIC5zaW5nbGUoKTtcclxuICAgIFxyXG4gIGlmIChlcnJvciB8fCAhZGF0YSkgdGhyb3cgbmV3IEVycm9yKFwiTm8gdG9rZW4gZm9yIHRlbmFudFwiKTtcclxuICByZXR1cm4gSlNPTi5wYXJzZShkZWNyeXB0KGRhdGEudG9rZW5fc2V0X2VuYykpO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q2xpZW50V2l0aFRva2Vucyh0ZW5hbnRJZDogc3RyaW5nKSB7XHJcbiAgY29uc3QgeGVybyA9IG5ld1hlcm9DbGllbnQoKTtcclxuICBjb25zdCB0b2tlblNldCA9IGF3YWl0IGxvYWRUb2tlblNldCh0ZW5hbnRJZCk7XHJcbiAgeGVyby5zZXRUb2tlblNldCh0b2tlblNldCk7XHJcblxyXG4gIC8vIHJlZnJlc2ggaWYgbmVlZGVkICh3aXRob3V0IHVzaW5nIEFjY291bnRpbmcgQVBJcylcclxuICBjb25zdCBleHAgPSB0b2tlblNldC5leHBpcmVzX2F0ID8gdG9rZW5TZXQuZXhwaXJlc19hdCAqIDEwMDAgOiAwO1xyXG4gIGlmIChleHAgJiYgZXhwIDwgRGF0ZS5ub3coKSArIDYwXzAwMCkge1xyXG4gICAgY29uc3QgcmVmcmVzaGVkID0gYXdhaXQgeGVyby5yZWZyZXNoVG9rZW4oKTtcclxuICAgIGF3YWl0IHNhdmVUb2tlblNldCh0ZW5hbnRJZCwgcmVmcmVzaGVkKTtcclxuICAgIHJldHVybiB7IHhlcm8sIHRlbmFudElkLCB0b2tlblNldDogcmVmcmVzaGVkIH07XHJcbiAgfVxyXG5cclxuICByZXR1cm4geyB4ZXJvLCB0ZW5hbnRJZCwgdG9rZW5TZXQgfTtcclxufVxyXG5cclxuLy8gRmV0Y2ggY29ubmVjdGlvbnMgd2l0aG91dCB0b3VjaGluZyBBY2NvdW50aW5nIGVuZHBvaW50c1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmV0Y2hDb25uZWN0aW9ucyhhY2Nlc3NUb2tlbjogc3RyaW5nKSB7XHJcbiAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goXCJodHRwczovL2FwaS54ZXJvLmNvbS9jb25uZWN0aW9uc1wiLCB7XHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthY2Nlc3NUb2tlbn1gLFxyXG4gICAgICBBY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgfSxcclxuICB9KTtcclxuICBpZiAoIXJlcy5vaykgdGhyb3cgbmV3IEVycm9yKGBjb25uZWN0aW9ucyBmYWlsZWQ6IEhUVFAgJHtyZXMuc3RhdHVzfWApO1xyXG4gIHJldHVybiBhd2FpdCByZXMuanNvbigpO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJYZXJvQ2xpZW50Iiwic3VwYWJhc2VBZG1pbiIsImVuY3J5cHQiLCJkZWNyeXB0IiwibmV3WGVyb0NsaWVudCIsImNsaWVudElkIiwicHJvY2VzcyIsImVudiIsIlhFUk9fQ0xJRU5UX0lEIiwiY2xpZW50U2VjcmV0IiwiWEVST19DTElFTlRfU0VDUkVUIiwicmVkaXJlY3RVcmlzIiwiWEVST19SRURJUkVDVF9VUkkiLCJzY29wZXMiLCJuZXdYcG1Pbmx5Q2xpZW50Iiwic2F2ZVRva2VuU2V0IiwidGVuYW50SWQiLCJ0b2tlblNldCIsInRva2VuSnNvbiIsIkpTT04iLCJzdHJpbmdpZnkiLCJleHBpcmVzQXQiLCJleHBpcmVzX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwibm93IiwiZXJyb3IiLCJmcm9tIiwidXBzZXJ0IiwidGVuYW50X2lkIiwidG9rZW5fc2V0X2VuYyIsInVwZGF0ZWRfYXQiLCJvbkNvbmZsaWN0IiwiRXJyb3IiLCJtZXNzYWdlIiwibG9hZFRva2VuU2V0IiwiZGF0YSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwicGFyc2UiLCJnZXRDbGllbnRXaXRoVG9rZW5zIiwieGVybyIsInNldFRva2VuU2V0IiwiZXhwIiwicmVmcmVzaGVkIiwicmVmcmVzaFRva2VuIiwiZmV0Y2hDb25uZWN0aW9ucyIsImFjY2Vzc1Rva2VuIiwicmVzIiwiZmV0Y2giLCJoZWFkZXJzIiwiQXV0aG9yaXphdGlvbiIsIkFjY2VwdCIsIm9rIiwic3RhdHVzIiwianNvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/xero.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next@14.0.0_react-dom@18.3.1_react@18.3.1__react@18.3.1","vendor-chunks/xero-node@13.0.0","vendor-chunks/tr46@0.0.3","vendor-chunks/jose@4.15.9","vendor-chunks/@supabase+auth-js@2.71.1","vendor-chunks/axios@1.12.2","vendor-chunks/mime-db@1.52.0","vendor-chunks/openid-client@5.7.1","vendor-chunks/@supabase+realtime-js@2.15.5","vendor-chunks/@supabase+node-fetch@2.6.15","vendor-chunks/@supabase+postgrest-js@1.21.4","vendor-chunks/@supabase+storage-js@2.12.1","vendor-chunks/whatwg-url@5.0.0","vendor-chunks/follow-redirects@1.15.11","vendor-chunks/debug@4.4.3","vendor-chunks/@supabase+supabase-js@2.57.4","vendor-chunks/object-hash@2.2.0","vendor-chunks/get-intrinsic@1.3.0","vendor-chunks/form-data@4.0.4","vendor-chunks/yallist@4.0.0","vendor-chunks/lru-cache@6.0.0","vendor-chunks/asynckit@0.4.0","vendor-chunks/@supabase+functions-js@2.4.6","vendor-chunks/combined-stream@1.0.8","vendor-chunks/webidl-conversions@3.0.1","vendor-chunks/mime-types@2.1.35","vendor-chunks/proxy-from-env@1.1.0","vendor-chunks/oidc-token-hash@5.1.1","vendor-chunks/ms@2.1.3","vendor-chunks/supports-color@7.2.0","vendor-chunks/has-symbols@1.1.0","vendor-chunks/delayed-stream@1.0.0","vendor-chunks/function-bind@1.1.2","vendor-chunks/es-set-tostringtag@2.1.0","vendor-chunks/call-bind-apply-helpers@1.0.2","vendor-chunks/get-proto@1.0.1","vendor-chunks/dunder-proto@1.0.1","vendor-chunks/math-intrinsics@1.1.0","vendor-chunks/es-errors@1.3.0","vendor-chunks/has-flag@4.0.0","vendor-chunks/es-define-property@1.0.1","vendor-chunks/gopd@1.2.0","vendor-chunks/hasown@2.0.2","vendor-chunks/has-tostringtag@1.0.2","vendor-chunks/es-object-atoms@1.1.1"], () => (__webpack_exec__("(rsc)/./node_modules/.pnpm/next@14.0.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fxero%2Fcallback%2Froute&page=%2Fapi%2Fxero%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fxero%2Fcallback%2Froute.ts&appDir=C%3A%5CUsers%5Cmayin%5CDesktop%5Cxero_test%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cmayin%5CDesktop%5Cxero_test&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();